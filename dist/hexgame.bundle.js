!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hexgame=e():t.hexgame=e()}(self,(function(){return(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);class e{constructor(t,e){this.x=t,this.y=e}add(t){return new e(this.x+t.x,this.y+t.y)}subtract(t){return new e(this.x-t.x,this.y-t.y)}scale(t){return new e(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return new e(this.y*t.x-this.x*t.y,this.x*t.y-this.y*t.x)}unit(){return this.scale(Math.inv(this.magnitude()))}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}max(){return Math.max(this.x,this.y)}min(){return Math.min(this.x,this.y)}rotate(t){return new e(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}equals(t){return this.x==t.x&&this.y==t.y}toString(){return`[${this.x}, ${this.y}]`}toArray(){return[this.x,this.y]}clone(){return new e(this.x,this.y)}get length(){return Math.sqrt(this.dot(this))}}class i{constructor(t){if("Entity"==this.constructor)throw new Error("Abstract classes can't be instantiated.");const i={position:new e(0,0)};Object.assign(this,i,Object.fromEntries(Object.keys(i).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t){}draw(t){}get x(){return this.position.x}get y(){return this.position.y}}class s extends i{constructor(t){super(t);const e={label:"",value:"",callback:null};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t){"function"==typeof this.callback&&(this.value=this.callback.call())}draw(t){t.font="16px Arial",t.fillStyle="black",t.fillText(this.toString(),this.position.x,this.position.y)}toString(){return`${this.label}: ${this.value}`}}class n{constructor(){window.addEventListener("keydown",(t=>this.handleKeyEvent(t,!0)),!1),window.addEventListener("keyup",(t=>this.handleKeyEvent(t,!1)),!1),this.input={UP:!1,DOWN:!1,LEFT:!1,RIGHT:!1}}handleKeyEvent(t,e){if(!t.defaultPrevented){switch(t.key){case"w":case"W":case"Up":case"ArrowUp":this.input.UP=e;break;case"s":case"S":case"Down":case"ArrowDown":this.input.DOWN=e;break;case"a":case"A":case"Left":case"ArrowLeft":this.input.LEFT=e;break;case"d":case"D":case"Right":case"ArrowRight":this.input.RIGHT=e;break;default:return}t.preventDefault()}}toString(){return JSON.stringify(this.input)}}class a{constructor(t,e,i){this.q=t,this.r=e,this.s=i}toString(){return`q:${this.q}|r:${this.r}|s:${this.s}`}}class r extends i{constructor(t){super(t);const i={hex:null,radius:null,center:new e(0,0),fillColor:"#FFFFFF",selected:!1};Object.assign(this,i,Object.fromEntries(Object.keys(i).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t,i){if(t.client.frameCount%5==0){let t=this.radius*(Math.sqrt(3)*this.hex.q+Math.sqrt(3)/2*this.hex.r),s=1.5*this.radius*this.hex.r;this.center=i.position.add(new e(t,s))}let s=this.getVertices(this.center),n=new e(t.mouse.input.cursorX,t.mouse.input.cursorY),a=this.pointInPoly(s,n);a&&(1==this.lastMouseButtonState&&0==t.mouse.input.button.LEFT&&(this.selected=!this.selected),this.lastMouseButtonState=t.mouse.input.button.LEFT);let r=this.selected;a&&r?this.color="#A020F0":a?this.color="#0000FF":r&&(this.color="#FF0000")}handleInput(){}draw(t){t.beginPath(),t.fillStyle=this.color;for(let e of this.getVertices(this.center))t.lineTo(e.x,e.y);t.closePath(),t.stroke(),t.fill()}getVertices(t){let i=[];const s=new e(this.radius,0);for(var n=0;n<6;n++){let e=t.add(s.rotate(n*(2*Math.PI/6)+Math.PI/180*30));i.push(e)}return i}pointInPoly(t,e){let i=!1,s=t,n=e;for(let t=0,e=s.length-1;t<s.length;t++){let a=s[t].y<n.y&&s[e].y>=n.y,r=s[e].y<n.y&&s[t].y>=n.y,o=s[t].x<=n.x||s[e].x<n.x;(a||r)&&o&&(i^=s[t].x+(n.y-s[t].y)/(s[e].y-s[t].y)*(s[e].x-s[t].x)<n.x),e=t}return i}}class o extends i{constructor(t){super(t);const e={cellPadding:0,cellRadius:0,columns:15,rows:10,cells:[]};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]])))),this.build(this.columns,this.rows)}build(t,e){this.cells=[];for(let i=0;i<e;i++){let e=Math.floor(i/2);for(let s=-e;s<t-e;s++)this.cells.push(new r({hex:new a(s,i,-s-i),radius:this.cellRadius}))}}draw(t){for(let e of this.cells)e.draw(t)}update(t){for(let e of this.cells)e.update(t,this)}}class h{constructor(){window.addEventListener("mousemove",(t=>this.handleMove(t)),!1),window.addEventListener("mousedown",(t=>this.handleKeyEvent(t,!0)),!1),window.addEventListener("mouseup",(t=>this.handleKeyEvent(t,!1)),!1),window.addEventListener("contextmenu",(t=>this.handleContextMenu(t)),!1),this.input={button:{LEFT:!1,MIDDLE:!1,RIGHT:!1},cursorX:0,cursorY:0}}handleKeyEvent(t,e){if((t=t||window.event).preventDefault(),"which"in t)switch(t.which){case 1:this.input.button.LEFT=e;break;case 2:this.input.button.MIDDLE=e;break;case 3:this.input.button.RIGHT=e}else if("button"in t)switch(t.button){case 0:this.input.button.LEFT=e;break;case 1:this.input.button.MIDDLE=e;break;case 2:this.input.button.RIGHT=e}}handleMove(t){(t=t||window.event).preventDefault(),this.input.cursorX=t.clientX,this.input.cursorY=t.clientY}handleContextMenu(t){(t=t||window.event).preventDefault()}toString(){return JSON.stringify(this.input)}}class c{constructor(t,e,i,s){this.config={width:t,height:e,targetFps:i},this.state={status:"running",client:{curFPS:0,frameCount:0,lastFPSUpdate:0,framesThisSecond:0,tick:1e3/i,lastGameTick:0,nextGameTick:0},entities:[],keyboard:new n,mouse:new h},this.viewport=function(t,e){console.log("Generating canvas.");var i=document.createElement("canvas"),s=i.getContext("2d"),n=function(t){return console.log("Determining pixel ratio."),window.devicePixelRatio/["webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio"].reduce((function(e,i){return t.hasOwnProperty(i)?t[i]:1}))}(s);return i.width=Math.round(t*n),i.height=Math.round(e*n),i.style.width=t+"px",i.style.height=e+"px",s.setTransform(n,0,0,n,0,0),i}(this.config.width,this.config.height),this.context=this.viewport.getContext("2d"),s.insertBefore(this.viewport,s.firstChild)}init(){this.state.entities=[],this.state.entities.push(new s({position:new e(10,30),label:"FPS",callback:()=>this.state.client.curFPS})),this.state.entities.push(new s({position:new e(10,50),label:"Frames",callback:()=>this.state.client.frameCount})),this.state.entities.push(new s({position:new e(10,70),label:"keysPressed",callback:()=>this.state.keyboard.toString()})),this.state.entities.push(new s({position:new e(10,90),label:"mouse",callback:()=>this.state.mouse.toString()})),this.state.entities.push(new o({position:new e(25,120),cellRadius:15,columns:4,rows:4})),this.frameid=window.requestAnimationFrame(this.gameTick.bind(this))}gameTick(t){"paused"==this.state.status&&cancelAnimationFrame(this.frameid),t>this.state.client.nextGameTick&&(this.state.client.nextGameTick+=this.state.client.tick,this.state.client.frameCount++,this.update(t),this.draw()),this.state.client.lastGameTick=t,this.frameid=window.requestAnimationFrame(this.gameTick.bind(this))}update(t){t>this.state.client.lastFPSUpdate+1e3?(this.state.client.curFPS=this.state.client.framesThisSecond,this.state.client.lastFPSUpdate=t,this.state.client.framesThisSecond=0):this.state.client.framesThisSecond++;for(let t of this.state.entities)t.update(this.state)}draw(){this.context.clearRect(0,0,this.config.width,this.config.height);for(let t of this.state.entities)t.draw(this.context)}}return document.addEventListener("DOMContentLoaded",(function(t){window.game=new c(800,600,60,document.querySelector("body")),window.game.init()})),t})()}));