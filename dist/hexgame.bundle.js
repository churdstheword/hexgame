!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.HexEngine=e():t.HexEngine=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{core:()=>l,entities:()=>u,utils:()=>d});class s{static getPixelRatio=function(t){return console.log("Determining pixel ratio."),window.devicePixelRatio/["webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio"].reduce((function(e,s){return t.hasOwnProperty(s)?t[s]:1}))};static generateCanvas=function(t,e){console.log("Generating canvas.");var s=document.createElement("canvas"),i=s.getContext("2d"),n=this.getPixelRatio(i);return s.width=Math.round(t*n),s.height=Math.round(e*n),s.style.width=t+"px",s.style.height=e+"px",i.setTransform(n,0,0,n,0,0),s}}class i{constructor(){window.addEventListener("keydown",(t=>this.handleKeyEvent(t,!0)),!1),window.addEventListener("keyup",(t=>this.handleKeyEvent(t,!1)),!1),this.input={UP:!1,DOWN:!1,LEFT:!1,RIGHT:!1}}handleKeyEvent(t,e){if(!t.defaultPrevented){switch(t.key){case"w":case"W":case"Up":case"ArrowUp":this.input.UP=e;break;case"s":case"S":case"Down":case"ArrowDown":this.input.DOWN=e;break;case"a":case"A":case"Left":case"ArrowLeft":this.input.LEFT=e;break;case"d":case"D":case"Right":case"ArrowRight":this.input.RIGHT=e;break;default:return}t.preventDefault()}}toString(){return JSON.stringify(this.input)}}class n{constructor(t,e){this.x=t,this.y=e}add(t){return new n(this.x+t.x,this.y+t.y)}subtract(t){return new n(this.x-t.x,this.y-t.y)}scale(t){return new n(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return new n(this.y*t.x-this.x*t.y,this.x*t.y-this.y*t.x)}unit(){return this.scale(Math.inv(this.magnitude()))}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}max(){return Math.max(this.x,this.y)}min(){return Math.min(this.x,this.y)}rotate(t){return new n(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}equals(t){return this.x==t.x&&this.y==t.y}toString(){return`[${this.x}, ${this.y}]`}toArray(){return[this.x,this.y]}clone(){return new n(this.x,this.y)}get length(){return Math.sqrt(this.dot(this))}}class r{constructor(t){window.addEventListener("mousemove",(t=>this.handleMove(t)),!1),window.addEventListener("mousedown",(t=>this.handleKeyEvent(t,!0)),!1),window.addEventListener("mouseup",(t=>this.handleKeyEvent(t,!1)),!1),window.addEventListener("contextmenu",(t=>this.handleContextMenu(t)),!1),this.viewport=t,this.input={button:{LEFT:!1,MIDDLE:!1,RIGHT:!1},cursorX:0,cursorY:0}}handleKeyEvent(t,e){if((t=t||window.event).preventDefault(),"which"in t)switch(t.which){case 1:this.input.button.LEFT=e;break;case 2:this.input.button.MIDDLE=e;break;case 3:this.input.button.RIGHT=e}else if("button"in t)switch(t.button){case 0:this.input.button.LEFT=e;break;case 1:this.input.button.MIDDLE=e;break;case 2:this.input.button.RIGHT=e}}handleMove(t){(t=t||window.event).preventDefault(),this.input.cursorX=t.clientX,this.input.cursorY=t.clientY}handleContextMenu(t){(t=t||window.event).preventDefault()}getMousePosition(){let t=this.viewport.getBoundingClientRect();return new n(this.input.cursorX-t.left,this.input.cursorY-t.top)}toString(){return JSON.stringify(this.input)}}class o{constructor(t){if("Entity"==this.constructor)throw new Error("Abstract classes can't be instantiated.");const e={position:new n(0,0)};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t){}draw(t){}get x(){return this.position.x}get y(){return this.position.y}}class a extends o{constructor(t){if(super(t),"Polygon"==this.constructor)throw new Error("Abstract classes can't be instantiated.");const e={r:10,θ:Math.PI/180*90};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}getVertices(t){const e=[],s=new n(this.r,0);for(var i=0;i<t;i++){let n=this.position.add(s.rotate(i*(2*Math.PI/t)+this.θ));e.push(n)}return e}}class h{constructor(t,e,s){this.q=t,this.r=e,this.s=s}toString(){return`q:${this.q}|r:${this.r}|s:${this.s}`}}class c extends o{constructor(t){super(t);const e={hex:null,radius:null,center:new n(0,0),fillColor:"#FFFFFF",selected:!1};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t,e){if(t.client.frameCount%5==0){let t=this.radius*(Math.sqrt(3)*this.hex.q+Math.sqrt(3)/2*this.hex.r),s=1.5*this.radius*this.hex.r;this.center=e.position.add(new n(t,s))}let s=this.getVertices(this.center),i=t.mouse.getMousePosition(),r=this.pointInPoly(s,i);r&&(1==this.lastMouseButtonState&&0==t.mouse.input.button.LEFT&&(this.selected=!this.selected),this.lastMouseButtonState=t.mouse.input.button.LEFT);let o=this.selected;this.color=r&&o?"#3C5BC3":r&&!o?"#C1993E":o?"#637CCF":"#CDAD65"}draw(t){t.beginPath(),t.fillStyle=this.color;for(let e of this.getVertices(this.center))t.lineTo(e.x,e.y);t.closePath(),t.stroke(),t.fill()}getVertices(t){let e=[];const s=new n(this.radius,0);for(var i=0;i<6;i++){let n=t.add(s.rotate(i*(2*Math.PI/6)+Math.PI/180*30));e.push(n)}return e}pointInPoly(t,e){let s=!1,i=t,n=e;for(let t=0,e=i.length-1;t<i.length;t++){let r=i[t].y<n.y&&i[e].y>=n.y,o=i[e].y<n.y&&i[t].y>=n.y,a=i[t].x<=n.x||i[e].x<n.x;(r||o)&&a&&(s^=i[t].x+(n.y-i[t].y)/(i[e].y-i[t].y)*(i[e].x-i[t].x)<n.x),e=t}return s}}const l={Game:class{constructor(t,e,n,o){this.config={width:t,height:e,targetFps:n},this.viewport=s.generateCanvas(this.config.width,this.config.height),this.context=this.viewport.getContext("2d"),o.insertBefore(this.viewport,o.firstChild),this.state={status:"running",client:{curFPS:0,frameCount:0,lastFPSUpdate:0,framesThisSecond:0,tick:1e3/n,lastGameTick:0,nextGameTick:0},entities:[],keyboard:new i,mouse:new r(this.viewport)}}init(){this.state.entities=[],this.frameid=window.requestAnimationFrame(this.gameTick.bind(this))}gameTick(t){"paused"==this.state.status&&cancelAnimationFrame(this.frameid),t>this.state.client.nextGameTick&&(this.state.client.nextGameTick+=this.state.client.tick,this.state.client.frameCount++,this.update(t),this.draw()),this.state.client.lastGameTick=t,this.frameid=window.requestAnimationFrame(this.gameTick.bind(this))}update(t){t>this.state.client.lastFPSUpdate+1e3?(this.state.client.curFPS=this.state.client.framesThisSecond,this.state.client.lastFPSUpdate=t,this.state.client.framesThisSecond=0):this.state.client.framesThisSecond++;for(let t of this.state.entities)t.update(this.state)}draw(){this.context.clearRect(0,0,this.config.width,this.config.height);for(let t of this.state.entities)t.draw(this.context)}appendTo(){}},Events:class{constructor(){this.events={}}on(t,e){this.events.hasOwnProperty(t)||(this.events[t]=[]),this.events[t].push(e)}off(t,e){if(this.events.hasOwnProperty(t)){const s=[];for(const i of this.events[t])e!==i&&s.push(i);this.events=s}}trigger(t,...e){if(this.events.hasOwnProperty(t))for(const t of this.events.name)t.apply(this,e)}},Scene:class{construct(){}},constants:{PI:3.14159}},u={entity:o,shapes:{Polygon:a,Hexagon:class extends a{constructor(t,e,s=0){super(t,e,s),this.sides=6}update(t){this.θ=(this.θ-Math.PI/120)%(2*Math.PI)}draw(t){t.beginPath();for(let e of this.getVertices(this.sides))t.lineTo(e.x,e.y);t.closePath(),t.stroke()}},Square:class extends a{constructor(t){super(t);const e={sides:4};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t){const e=[];t.keyboard.input.LEFT&&e.push(new n(-1,0)),t.keyboard.input.RIGHT&&e.push(new n(1,0)),t.keyboard.input.UP&&e.push(new n(0,-1)),t.keyboard.input.DOWN&&e.push(new n(0,1));const s=e.reduce(((t,e)=>t.add(e)),new n(0,0));this.position=this.position.add(s)}draw(t){t.beginPath(),t.fillStyle="#a1b2c3";for(let e of this.getVertices(this.sides))t.lineTo(e.x,e.y);t.closePath(),t.stroke(),t.fill()}},Triangle:class extends a{constructor(t,e,s=0){super(t,e,s),this.sides=3}update(t){this.θ=(this.θ+Math.PI/30)%(2*Math.PI),this.r=30+15*Math.sin(t.client.frameCount%60*6*(Math.PI/180)),this.position=this.position.add(new n(2*Math.sin(t.client.frameCount%360*(Math.PI/180)),0))}draw(t){t.beginPath();for(let e of this.getVertices(this.sides))t.lineTo(e.x,e.y);t.closePath(),t.stroke()}}},text:{Debug:class extends o{constructor(t){super(t);const e={label:"",value:"",callback:null};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]]))))}update(t){"function"==typeof this.callback&&(this.value=this.callback.call())}draw(t){t.font="px Arial",t.fillStyle="black",t.fillText(this.toString(),this.position.x,this.position.y)}toString(){return`${this.label}: ${this.value}`}}},HexGrid:class extends o{constructor(t){super(t);const e={cellPadding:0,cellRadius:0,columns:15,rows:10,cells:[]};Object.assign(this,e,Object.fromEntries(Object.keys(e).filter((e=>e in t)).map((e=>[e,t[e]])))),this.build(this.columns,this.rows)}build(t,e){this.cells=[];for(let s=0;s<e;s++){let e=Math.floor(s/2);for(let i=-e;i<t-e;i++)this.cells.push(new c({hex:new h(i,s,-i-s),radius:this.cellRadius}))}}draw(t){for(let e of this.cells)e.draw(t)}update(t){for(let e of this.cells)e.update(t,this)}},HexCell:c},d={Canvas:s,Hex:h,Mouse:r,Keyboard:i,Vector:n};return e})()}));
//# sourceMappingURL=hexgame.bundle.js.map